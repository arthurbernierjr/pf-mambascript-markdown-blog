React = require 'react'
{ useState, useEffect } = require 'react'
{ $, pureComponent } = require('mambascript/decision')(React)
PostContent = require './PostContent.mamba'
AppLayout = require './AppLayout.mamba'


App = ->
  [state, setState] = useState([])
  fetchPost = ->
    fetch('/api/posts')
      .then((response)->
        response.json()
      ).then((data)->
        setState(data)
      ).catch((err)->
        present err
      )
    return (-> null)

  useEffect(fetchPost, [])

  Posts = pureComponent (data) ->
    data.map((item) ->
      $ PostContent, { post: item }
    )

  return (
    $ AppLayout, =>
      unless state.length
        return $ 'h1', 'Loading ...'
      else
        $ 'div', Posts(state)
  )

module.exports = App
